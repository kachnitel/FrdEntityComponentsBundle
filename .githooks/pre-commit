#!/bin/bash
#
# Pre-commit hook to update metrics before each commit.
#
# To install: .githooks/install-hooks.sh

# Only update metrics if relevant files changed
RELEVANT_CHANGES=$(git diff --cached --name-only | grep -E '(src/|tests/|composer\.json|phpunit\.xml)' || true)

if [ -z "$RELEVANT_CHANGES" ]; then
    echo "â© No source changes, skipping metrics update"
    exit 0
fi

echo "ðŸ“Š Updating metrics before commit..."

# Update metrics (this will fail if tests/phpstan fail)
.metrics/update-metrics.sh

# Stage the updated files
git add README.md .metrics/badges.md .metrics/metrics.json 2>/dev/null || true

echo "âœ… Metrics updated and staged"
