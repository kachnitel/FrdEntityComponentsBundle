<div{{ attributes.defaults({ class: 'frd-attachment-manager' }) }}>
  {% block errors %}
    {% if this.errors|length > 0 %}
      <div class="row mb-3">
        {% for error in this.errors %}
          <div class="col-12">
            <div class="alert alert-danger" role="alert">
              {{ error }}
            </div>
          </div>
        {% endfor %}
      </div>
    {% endif %}
  {% endblock %}

  {% block attachment_list %}
    <div class="row g-3">
      {% for attachment in attachments %}
        {% block attachment_item %}
          <div class="col-12 col-sm-6 col-md-4 col-lg-3">
            <div class="card h-100">
              {% block attachment_preview %}
                {% if attachment.mimeType|split('/')|first == 'image' %}
                  <img
                    src="{{ attachment.path }}"
                    alt="{{ attachment.url }}"
                    class="card-img-top"
                    style="object-fit: cover; height: 200px;"
                  >
                {% else %}
                  <div class="card-img-top d-flex align-items-center justify-content-center bg-light" style="height: 200px;">
                    <div class="text-center">
                      <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="currentColor" class="bi bi-file-earmark" viewBox="0 0 16 16">
                        <path d="M14 4.5V14a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2h5.5L14 4.5zm-3 0A1.5 1.5 0 0 1 9.5 3V1H4a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V4.5h-2z"/>
                      </svg>
                      <div class="small mt-2">{{ attachment.url|split('.')|last|upper }}</div>
                    </div>
                  </div>
                {% endif %}
              {% endblock %}

              <div class="card-body">
                {% block attachment_info %}
                  <p class="card-text small text-truncate">
                    <a href="{{ attachment.path }}" target="_blank" class="text-decoration-none">
                      {{ attachment.url|split('/')|last }}
                    </a>
                  </p>
                {% endblock %}
              </div>

              {% if not this.readOnly %}
                <div class="card-footer">
                  {% block attachment_actions %}
                    <button
                      type="button"
                      class="btn btn-danger btn-sm w-100"
                      data-action="live#action"
                      data-live-id-param="{{ attachment.id }}"
                      data-live-csrf-token-param="{{ csrf_token('delete-file-' ~ attachment.id) }}"
                      data-live-action-param="deleteFile"
                      onclick="return confirm('Are you sure you want to delete this file?')"
                    >
                      Delete
                    </button>
                  {% endblock %}
                </div>
              {% endif %}
            </div>
          </div>
        {% endblock %}
      {% else %}
        {% block no_attachments %}
          <div class="col-12">
            <div class="alert alert-info" role="alert">
              No files attached.
            </div>
          </div>
        {% endblock %}
      {% endfor %}
    </div>
  {% endblock %}

  {% if not this.readOnly %}
    {% block upload_form %}
      <div class="mt-4">
        {{ form_start(form) }}
          {{ form_errors(form) }}
          {{ form_widget(form) }}

          <div class="btn-group mt-2" role="group">
            <button
              type="button"
              class="btn btn-secondary"
              data-action="live#action"
              data-live-action-param="addFile"
              {{ form.vars.disabled ? 'disabled' }}
            >
              Add File
            </button>
            <button
              type="button"
              class="btn btn-primary"
              data-action="live#action"
              data-live-action-param="{{ this.property }}|submit"
              {{ form.vars.disabled ? 'disabled' }}
            >
              Upload
            </button>
          </div>
        {{ form_end(form) }}
      </div>
    {% endblock %}
  {% endif %}
</div>

{% block loading_indicator %}
  <div data-loading="delay|show">
    <div class="spinner-border spinner-border-sm text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
  </div>
{% endblock %}
