<div{{ attributes.defaults({ class: 'kachnitel-attachment-manager' }) }}>
  {% block errors %}
    {% if this.errors|length > 0 %}
      <div class="row">
        {% for error in this.errors %}
          <div class="col-12">
            <div class="alert alert-danger" role="alert">
              {{ error }}
            </div>
          </div>
        {% endfor %}
      </div>
    {% endif %}
  {% endblock %}

  {% block attachment_list %}
    <div class="row">
      {% for attachment in attachments %}
        {% block attachment_item %}
          <div class="col-4 d-flex flex-column justify-content-between">
            {% block attachment_preview %}
              {% if attachment.mimeType|split('/')|first == 'image' %}
                <img
                  src="{{ attachment.path }}"
                  alt="{{ attachment.url }}"
                  class="img-thumbnail thumbnail"
                  style="object-fit: cover; aspect-ratio: 1; width: 100%;"
                >
              {% else %}
                <a href="{{ attachment.path }}" class="text-center text-decoration-none d-flex flex-column align-items-center justify-content-center border rounded p-3" style="aspect-ratio: 1;" target="_blank">
                  <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="currentColor" class="bi bi-file-earmark mb-2" viewBox="0 0 16 16">
                    <path d="M14 4.5V14a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2h5.5L14 4.5zm-3 0A1.5 1.5 0 0 1 9.5 3V1H4a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V4.5h-2z"/>
                  </svg>
                  <span class="small text-truncate w-100 text-center">{{ attachment.url|split('/')|last }}</span>
                </a>
              {% endif %}
            {% endblock %}

            {% block tag_manager %}
              {% if this.tagClass %}
                {{ component('FRD:Entity:TagManager', {
                  entity: attachment,
                  tagClass: this.tagClass,
                  readOnly: this.readOnly
                }) }}
              {% endif %}
            {% endblock %}

            {% if not this.readOnly %}
              {% block attachment_actions %}
                <button
                  type="button"
                  class="btn btn-danger btn-sm mt-2"
                  data-action="live#action"
                  data-live-id-param="{{ attachment.id }}"
                  data-live-csrf-token-param="{{ csrf_token('delete-file-' ~ attachment.id) }}"
                  data-live-action-param="deleteFile"
                  onclick="return confirm('Are you sure you want to delete this file?')"
                >
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash" viewBox="0 0 16 16">
                    <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"/>
                    <path fill-rule="evenodd" d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"/>
                  </svg>
                </button>
              {% endblock %}
            {% endif %}
          </div>
        {% endblock %}
      {% else %}
        {% block no_attachments %}
          <div class="col-12">
            <div class="alert alert-info" role="alert">
              No files.
            </div>
          </div>
        {% endblock %}
      {% endfor %}
    </div>
  {% endblock %}

  {% if not this.readOnly %}
    {% block upload_form %}
      <div class="mt-3">
        {{ form_start(form) }}
          {{ form_errors(form) }}
          {{ form_widget(form) }}
          <button
            type="button"
            class="btn btn-secondary"
            data-action="live#action"
            data-live-action-param="addFile"
            {{ form.vars.disabled ? 'disabled' }}
          >
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-plus-lg" viewBox="0 0 16 16">
              <path fill-rule="evenodd" d="M8 2a.5.5 0 0 1 .5.5v5h5a.5.5 0 0 1 0 1h-5v5a.5.5 0 0 1-1 0v-5h-5a.5.5 0 0 1 0-1h5v-5A.5.5 0 0 1 8 2Z"/>
            </svg>
            Add file
          </button>
          <button
            type="button"
            class="btn btn-primary"
            data-action="live#action"
            data-live-action-param="submit|files"
            {{ form.vars.disabled ? 'disabled' }}
          >
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-upload" viewBox="0 0 16 16">
              <path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z"/>
              <path d="M7.646 1.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708L8.5 2.707V11.5a.5.5 0 0 1-1 0V2.707L5.354 4.854a.5.5 0 1 1-.708-.708l3-3z"/>
            </svg>
            Upload
          </button>
        {{ form_end(form) }}
      </div>
    {% endblock %}
  {% endif %}
</div>

{% macro placeholder(props) %}
  <div class="spinner-border text-primary" role="status">
    <span class="visually-hidden">Loading...</span>
  </div>
{% endmacro %}
