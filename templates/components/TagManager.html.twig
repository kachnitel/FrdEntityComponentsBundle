<div{{ attributes.defaults({ class: 'frd-tag-manager' }) }}>
  {% block tag_list %}
    {% for tag in this.tags %}
      {% block tag_badge %}
        {% set bgColor = '#' ~ tag.categoryColor %}
        {% set textColor = bgColor|isLight ? '#000' : '#fff' %}
        <span class="badge tag me-1" style="background-color: {{ bgColor }}; color: {{ textColor }}; font-size: 0.75rem;">
          {{ tag.displayName|default(tag.value) }}
          {% if not this.readOnly %}
            <button
              type="button"
              class="btn-close ms-1"
              style="font-size: 0.5rem; filter: {{ bgColor|isLight ? 'none' : 'invert(1)' }};"
              data-action="live#action"
              data-live-tag-id-param="{{ tag.id }}"
              data-live-action-param="removeTag"
              aria-label="Remove tag"
            ></button>
          {% endif %}
        </span>
      {% endblock %}
    {% endfor %}
  {% endblock %}

  {% if not this.readOnly %}
    {% block add_button %}
      <button
        type="button"
        class="btn btn-sm btn-outline-primary"
        data-action="live#action"
        data-live-action-param="toggleTagList"
      >
        {% if this.showingTags %}
          Hide Tags
        {% else %}
          + Add Tag
        {% endif %}
      </button>
    {% endblock %}

    {% if this.showingTags %}
      {% block tag_selector %}
        <div class="frd-tag-selector mt-2 p-2 border rounded">
          <div class="d-flex flex-wrap gap-2">
            {% for tag in allTags|sort((a, b) => (a.displayName|default(a.value)) <=> (b.displayName|default(b.value))) %}
              {% set bgColor = '#' ~ tag.categoryColor %}
              {% set textColor = bgColor|isLight ? '#000' : '#fff' %}
              <button
                type="button"
                class="btn btn-sm"
                style="background-color: {{ bgColor }}; color: {{ textColor }}; border-color: {{ bgColor }};"
                data-action="live#action"
                data-live-tag-id-param="{{ tag.id }}"
                data-live-action-param="{{ tag in tags ? 'removeTag' : 'addTag' }}"
              >
                {{ tag in tags ? 'âˆ’' : '+' }} {{ tag.displayName|default(tag.value) }}
              </button>
            {% endfor %}
          </div>

          <div class="mt-2">
            <button
              type="button"
              class="btn btn-primary btn-sm"
              data-action="live#action"
              data-live-action-param="saveChanges"
            >
              Save
            </button>
            <button
              type="button"
              class="btn btn-secondary btn-sm"
              data-action="live#action"
              data-live-action-param="toggleTagList"
            >
              Cancel
            </button>
          </div>
        </div>
      {% endblock %}
    {% endif %}
  {% endif %}
</div>

{% macro placeholder(props) %}
  <div class="frd-tag-manager">
    <div class="spinner-border spinner-border-sm text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
  </div>
{% endmacro %}
